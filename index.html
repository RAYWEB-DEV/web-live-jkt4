<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JKT48 Live Theater</title>
<style>
body{margin:0;font-family:Arial;background:#0b0b0b;color:#fff}
header{background:#111;padding:15px;text-align:center;border-bottom:2px solid #c00000}
header img{height:48px}
.container{max-width:1200px;margin:20px auto;padding:0 15px}
.status{text-align:center;margin-bottom:20px}
.badge{padding:6px 14px;border-radius:6px;font-weight:bold}
.live{background:#c00000}
.offline{background:#444}
.countdown{font-size:18px;color:#ff4444;margin-top:8px}
.theater{display:flex;gap:15px;flex-wrap:wrap}
.video-wrapper{flex:2;min-width:320px;aspect-ratio:16/9;position:relative;background:#000;border-radius:10px;overflow:hidden;display:none}
.video-wrapper iframe{width:100%;height:100%;border:none}
.overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.35);cursor:pointer}
.overlay.hidden{background:transparent}
.play-btn{width:80px;height:80px;border-radius:50%;background:#c00000;display:flex;align-items:center;justify-content:center;font-size:32px}
.chat-wrapper{flex:1;min-width:300px;max-height:500px;background:#000;border-radius:10px;overflow:hidden;display:none}
.chat-wrapper iframe{width:100%;height:100%;border:none}
footer{text-align:center;color:#777;font-size:12px;margin:30px 0}
@media(max-width:768px){.theater{flex-direction:column}.chat-wrapper{max-height:300px}}
</style>
</head>
<body>
<header>
<img src="logo.png">
<h2>JKT48 Live Theater</h2>
</header>
<div class="container">
<div class="status">
<span id="badge" class="badge offline">OFFLINE</span>
<p id="statusText">Menunggu live dimulai</p>
<div id="countdown" class="countdown"></div>
</div>
<div class="theater">
<div class="video-wrapper" id="videoBox">
<div id="player"></div>
<div class="overlay" id="overlay">
<div class="play-btn" id="playIcon">▶</div>
</div>
</div>
<div class="chat-wrapper" id="chatBox"></div>
</div>
</div>
<footer>© 2025 ReplayShow JKT48</footer>
<script src="https://www.youtube.com/iframe_api"></script>
<script>
const CHANNEL_ID="UC-LT-pgYo8e_DSfGW-RpdLQ";
const DOMAIN=location.hostname;
let player,isPlaying=false,nextCheck=30,timer;
async function checkLive(){
 try{
  const r=await fetch(`/api/live?channelId=${CHANNEL_ID}`);
  const d=await r.json();
  if(d.live){clearInterval(timer);showLive(d.videoId);}
  else{showOffline();startCountdown();}
 }catch{showOffline();startCountdown();}
}
function showLive(videoId){
 badge.textContent="LIVE";badge.className="badge live";
 statusText.textContent="Sedang Live Streaming";countdown.textContent="";
 videoBox.style.display="block";chatBox.style.display="block";
 if(!player){
  player=new YT.Player('player',{videoId,
   playerVars:{controls:0,modestbranding:1,rel:0,fs:0},
   events:{onReady:()=>overlay.onclick=togglePlay,onStateChange:onState}});
 }
 chatBox.innerHTML=`<iframe src="https://www.youtube.com/live_chat?v=${videoId}&embed_domain=${DOMAIN}"></iframe>`;
}
function showOffline(){
 badge.textContent="OFFLINE";badge.className="badge offline";
 statusText.textContent="Menunggu live dimulai";
 videoBox.style.display="none";chatBox.style.display="none";
}
function onState(e){
 if(e.data===YT.PlayerState.PLAYING){
  isPlaying=true;playIcon.textContent="⏸";overlay.classList.add("hidden");
 }else{
  isPlaying=false;playIcon.textContent="▶";overlay.classList.remove("hidden");
 }
}
function togglePlay(){if(!player)return;isPlaying?player.pauseVideo():player.playVideo();}
function startCountdown(){
 clearInterval(timer);nextCheck=30;updateCountdown();
 timer=setInterval(()=>{nextCheck--;updateCountdown();
  if(nextCheck<=0){clearInterval(timer);checkLive();}},1000);
}
function updateCountdown(){countdown.textContent=`Cek live otomatis dalam ${nextCheck} detik`; }
checkLive();
</script>
</body>
</html>
